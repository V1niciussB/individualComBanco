<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="css/cadastroStyle.css">
    <script src="js/script.js"> </script>
    <link rel="shortcut icon" href="assets/sharkIcon.png">
    <title> SharkAcademy </title>
</head>


<!-- navezona da massa -->
<div class="block">
    <header>
        <div class="logonavbar">
            <img src="assets/logoShark.png" alt="">
            <ul>
                <li> <a href="index.html">HOME</a></li>
                <li> <a href="#"> NATAÇÃO </a></li>
                <li> <a href="#"> MODALIDADE</a></li>
                <li> <a href="#">ATLETAS</a></li>
                <li> <a href="sobreMim.html"> SOBRE MIM </a></li>
            </ul>
        </div>
        <div class="buttonslogcad">
            <a class="fakebutton" href="login.html">LOGIN</a>
            <a class="fakebutton" href="#">CADASTRE-SE</a>
        </div>
    </header>


    <!-- Inicio do form -->
    <div class="container">
        <div id="form" class="form">
            <h2>Cadastro do Nadador</h2>

            <div class="campos">
                <div class="campo">
                    <label for="nome_nadador">Nome:</label>
                    <input type="text" id="nome_input" placeholder="Nome do Nadador">
                </div>

                <div class="campo">
                    <label for="modalidade"> Modalidade: </label>
                    <select id="sel_modali" class="campo_sel">
                        <option value="">-- Selecione --</option>
                        <option value="1"> LIVRE </option>
                        <option value="2"> COSTAS </option>
                        <option value="3"> PEITO </option>
                        <option value="4"> BORBOLETA </option>
                    </select>
                </div>
            </div>


            <div class="campos">
                <div class="campo">
                    <label for="cpf">CPF:</label>
                    <input id="cpf_input" placeholder="XXX.XXX.XXX-XX">
                </div>

                <div class="campo">
                    <label for="dtNasc">Data de Nascimento</label>
                    <input id="dtNasc_input" type="date">
                </div>
            </div>


            <div class="campos">
                <div class="campo">
                    <label for="genero"> Gênero: </label>
                    <select id="sel_genero" class="campo_sel">
                        <option value="">-- Selecione --</option>
                        <option value="M"> Masculino </option>
                        <option value="F"> Feminino </option>
                    </select>
                </div>

                <div class="campo">
                    <label for="email">Email:</label>
                    <input id="email_input" placeholder="nadador@academy.com">
                </div>
            </div>


            <div class="campos">
                <div class="campo">
                    <label for="senha"> Senha: </label>
                    <input id="senha_input" type="password" placeholder="***********">
                </div>

                <div class="campo">
                    <label for="confirm"> Confimação de Senha: </label>
                    <input id="confirmaSenha_input" type="password" placeholder="***********">
                </div>
            </div>


            <div class="campos">
                <div class="campo">
                    <label for="tel"> Telefone: </label>
                    <input id="telefone_input" placeholder="11-99999-9999">
                </div>

                <div class="campo">
                    <button type="submit" onclick="cadastrar()">Registre-se</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function cadastrar() {
            //Recupere o valor da nova input pelo nome do id
            // Agora vá para o método fetch logo abaixo
            var confirmaSenhaVar = confirmaSenha_input.value;

            var nadador = {
                nomeServer: nome_input.value,
                emailServer: email_input.value,
                cpfServer: cpf_input.value,
                dtNascServer: dtNasc_input.value,
                telefoneServer: telefone_input.value,
                generoServer: sel_genero.value,
                senhaServer: senha_input.value,
                modalidadeServer: sel_modali.value,
                categoriaServer: "",
                fkCompServer: ""
            }

            var dataNasc = nadador.dtNascServer
            // Pegando a fatia correspondente ao ano do campo data 
            var ano = dataNasc.slice(0, 4)
            // Trazendo o anoAtual (new date pega a data e fullYear o ano)
            var anoAtual = new Date().getFullYear()
            var idade = anoAtual - ano
            console.log(idade)

            if (idade > 25) {
                nadador.categoriaServer = "Master"
            } else if (idade > 20) {
                nadador.categoriaServer = "Senior"
            } else if (idade > 17) {
                nadador.categoriaServer = "Junior"
            } else if (idade > 15) {
                nadador.categoriaServer = "Juvenil"
            } else {
                alert(`Desculpe, você ainda não possui a idade mínima para participar da competição!`)
            }
            console.log(nadador)

            var categoria = nadador.categoriaServer
            var modal = nadador.modalidadeServer

            // primeiro horário da competição baseado na modalidade e categoria
            if (categoria == "Juvenil" && modal == 1) {
                nadador.fkCompServer = 1
            } else if (categoria == "Junior" && modal == 1) {
                nadador.fkCompServer = 2
            } else if (categoria == "Senior" && modal == 1) {
                nadador.fkCompServer = 3
            } else if (categoria == "Master" && modal == 1) {
                nadador.fkCompServer = 4
            }

            else if (categoria == "Juvenil" && modal == 2) {
                nadador.fkCompServer = 5
            } else if (categoria == "Junior" && modal == 2) {
                nadador.fkCompServer = 6
            } else if (categoria == "Senior" && modal == 2) {
                nadador.fkCompServer = 7
            } else if (categoria == "Master" && modal == 2) {
                nadador.fkCompServer = 8
            }

            else if (categoria == "Juvenil" && modal == 3) {
                nadador.fkCompServer = 9
            } else if (categoria == "Junior" && modal == 3) {
                nadador.fkCompServer = 10
            } else if (categoria == "Senior" && modal == 3) {
                nadador.fkCompServer = 11
            } else if (categoria == "Master" && modal == 3) {
                nadador.fkCompServer = 12
            }

            else if (categoria == "Juvenil" && modal == 4) {
                nadador.fkCompServer = 13
            } else if (categoria == "Junior" && modal == 4) {
                nadador.fkCompServer = 14
            } else if (categoria == "Senior" && modal == 4) {
                nadador.fkCompServer = 15
            } else if (categoria == "Master" && modal == 4) {
                nadador.fkCompServer = 16
            }


            // if(nome_input.value == "" || email_input.value == "" || cpf_input.value == "" || dtNasc_input.value == "" || telefone_input.value //== //""  sel_genero.value == "" || senha_input.value == "" || sel_modali.value == ""){
            //   alert('Cadastro inválido, preencha todos os campos e tente novamente!')
            //  }

            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(nadador)
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    alert("Cadastro Realizado com sucesso!!")
                    window.location.href = "login.html"
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;



        }
    </script>